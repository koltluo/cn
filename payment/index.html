<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index, follow" />
  <link rel="icon shortcut" href="/favicon.ico" sizes="32x32" />
<link rel="icon" href="/favicon.svg" type="image/svg+xml" />
<link rel="icon" href="/favicon-dark.svg" type="image/svg+xml" media="(prefers-color-scheme: dark)" />
<link rel="icon" href="/favicon-16x16.png" type="image/png" sizes="16x16" />
<link rel="icon" href="/favicon-32x32.png" type="image/png" sizes="32x32" />
<link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180" />
<link fetchpriority="low" href="/site.webmanifest" rel="manifest" />
<title>订单信息确认 – 山东临沂森阔机电有限公司</title>
  <meta name="description" content="" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"><link rel="canonical" href="https://cn.lyskjd.com/payment/" itemprop="url" />

<meta property="og:title" content="订单信息确认" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cn.lyskjd.com/payment/" /><meta property="article:section" content="" />



  <meta itemprop="name" content="订单信息确认">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="订单信息确认">

    <link rel="preload" href="/css/compiled/main.min.0d60cbb74d97ccaea83c3ea6d973c5961d69642b38588069a503bc04e284cbc7.css" as="style" integrity="sha256-DWDLt02XzK6oPD6m2XPFlh1pZCs4WIBppQO8BOKEy8c=" />
    <link href="/css/compiled/main.min.0d60cbb74d97ccaea83c3ea6d973c5961d69642b38588069a503bc04e284cbc7.css" rel="stylesheet" integrity="sha256-DWDLt02XzK6oPD6m2XPFlh1pZCs4WIBppQO8BOKEy8c=" />



  <link href="/css/custom.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css" rel="stylesheet" integrity="sha256-47DEQpj8HBSa&#43;/TImW&#43;5JCeuQeRkm5NMpJWZG3hSuFU=" />


  <script>
     
    const defaultTheme = 'system';

    const setDarkTheme = () => {
      document.documentElement.classList.add("dark");
      document.documentElement.style.colorScheme = "dark";
    }
    const setLightTheme = () => {
      document.documentElement.classList.remove("dark");
      document.documentElement.style.colorScheme = "light";
    }

    if ("color-theme" in localStorage) {
      localStorage.getItem("color-theme") === "dark" ? setDarkTheme() : setLightTheme();
    } else {
      defaultTheme === "dark" ? setDarkTheme() : setLightTheme();
      if (defaultTheme === "system") {
        window.matchMedia("(prefers-color-scheme: dark)").matches ? setDarkTheme() : setLightTheme();
      }
    }
  </script>

  
<script>
    document.addEventListener('contextmenu', function(e) {
        e.preventDefault();
    });
    
    document.onselectstart = function() { return false; }
      </script>
    
    
    <script>
      (function(){var w=window;if(w.ChannelIO){return w.console.error("ChannelIO script included twice.");}var ch=function(){ch.c(arguments);};ch.q=[];ch.c=function(args){ch.q.push(args);};w.ChannelIO=ch;function l(){if(w.ChannelIOInitialized){return;}w.ChannelIOInitialized=true;var s=document.createElement("script");s.type="text/javascript";s.async=true;s.src="https://cdn.channel.io/plugin/ch-plugin-web.js";var x=document.getElementsByTagName("script")[0];if(x.parentNode){x.parentNode.insertBefore(s,x);}}if(document.readyState==="complete"){l();}else{w.addEventListener("DOMContentLoaded",l);w.addEventListener("load",l);}})();
    
      ChannelIO('boot', {
        "pluginKey": "b9962139-2190-4324-8ea7-4d7e66cfa543"
      });
    </script>
    <script defer src="https://us.umami.is/script.js" data-website-id="eee1399d-52c9-4212-8f4d-4e1ea24a8e42"></script>
</head>
<body dir="ltr"><div class="nav-container hx-sticky hx-top-0 hx-z-20 hx-w-full hx-bg-transparent print:hx-hidden">
  <div class="nav-container-blur hx-pointer-events-none hx-absolute hx-z-[-1] hx-h-full hx-w-full hx-bg-white dark:hx-bg-dark hx-shadow-[0_2px_4px_rgba(0,0,0,.02),0_1px_0_rgba(0,0,0,.06)] contrast-more:hx-shadow-[0_0_0_1px_#000] dark:hx-shadow-[0_-1px_0_rgba(255,255,255,.1)_inset] contrast-more:dark:hx-shadow-[0_0_0_1px_#fff]"></div>

  <nav class="hx-mx-auto hx-flex hx-items-center hx-justify-end hx-gap-2 hx-h-16 hx-px-6 hx-max-w-[90rem]">
    <a class="hx-flex hx-items-center hover:hx-opacity-75 ltr:hx-mr-auto rtl:hx-ml-auto" href="/">
        <img class="hx-block dark:hx-hidden" src="/images/logo.svg" alt="山东临沂森阔机电有限公司" height="40" width="40" />
        <img class="hx-hidden dark:hx-block" src="/images/logo-dark.svg" alt="山东临沂森阔机电有限公司" height="40" width="40" />
        <span class="hx-mx-2 hx-font-extrabold hx-inline hx-select-none" title="山东临沂森阔机电有限公司">山东临沂森阔机电有限公司</span>
    </a><svg height=24 xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M152.1 236.2c-3.5-12.1-7.8-33.2-7.8-33.2h-.5s-4.3 21.1-7.8 33.2l-11.1 37.5H163zM616 96H336v320h280c13.3 0 24-10.7 24-24V120c0-13.3-10.7-24-24-24zm-24 120c0 6.6-5.4 12-12 12h-11.4c-6.9 23.6-21.7 47.4-42.7 69.9 8.4 6.4 17.1 12.5 26.1 18 5.5 3.4 7.3 10.5 4.1 16.2l-7.9 13.9c-3.4 5.9-10.9 7.8-16.7 4.3-12.6-7.8-24.5-16.1-35.4-24.9-10.9 8.7-22.7 17.1-35.4 24.9-5.8 3.5-13.3 1.6-16.7-4.3l-7.9-13.9c-3.2-5.6-1.4-12.8 4.2-16.2 9.3-5.7 18-11.7 26.1-18-7.9-8.4-14.9-17-21-25.7-4-5.7-2.2-13.6 3.7-17.1l6.5-3.9 7.3-4.3c5.4-3.2 12.4-1.7 16 3.4 5 7 10.8 14 17.4 20.9 13.5-14.2 23.8-28.9 30-43.2H412c-6.6 0-12-5.4-12-12v-16c0-6.6 5.4-12 12-12h64v-16c0-6.6 5.4-12 12-12h16c6.6 0 12 5.4 12 12v16h64c6.6 0 12 5.4 12 12zM0 120v272c0 13.3 10.7 24 24 24h280V96H24c-13.3 0-24 10.7-24 24zm58.9 216.1L116.4 167c1.7-4.9 6.2-8.1 11.4-8.1h32.5c5.1 0 9.7 3.3 11.4 8.1l57.5 169.1c2.6 7.8-3.1 15.9-11.4 15.9h-22.9a12 12 0 0 1 -11.5-8.6l-9.4-31.9h-60.2l-9.1 31.8c-1.5 5.1-6.2 8.7-11.5 8.7H70.3c-8.2 0-14-8.1-11.4-15.9z"/></svg><div id="translate" >
      
    </div><a
            title="产品"
            href="/products"
            
            class="hx-text-sm contrast-more:hx-text-gray-700 contrast-more:dark:hx-text-gray-100 hx-relative -hx-ml-2 hx-hidden hx-whitespace-nowrap hx-p-2 md:hx-inline-block hx-text-gray-600 hover:hx-text-gray-800 dark:hx-text-gray-400 dark:hover:hx-text-gray-200"
          >
            <span class="hx-text-center">产品</span>
          </a><a
            title="文档"
            href="/docs"
            
            class="hx-text-sm contrast-more:hx-text-gray-700 contrast-more:dark:hx-text-gray-100 hx-relative -hx-ml-2 hx-hidden hx-whitespace-nowrap hx-p-2 md:hx-inline-block hx-text-gray-600 hover:hx-text-gray-800 dark:hx-text-gray-400 dark:hover:hx-text-gray-200"
          >
            <span class="hx-text-center">文档</span>
          </a><a
            title="博客"
            href="/blog"
            
            class="hx-text-sm contrast-more:hx-text-gray-700 contrast-more:dark:hx-text-gray-100 hx-relative -hx-ml-2 hx-hidden hx-whitespace-nowrap hx-p-2 md:hx-inline-block hx-text-gray-600 hover:hx-text-gray-800 dark:hx-text-gray-400 dark:hover:hx-text-gray-200"
          >
            <span class="hx-text-center">博客</span>
          </a><a
            title="关于"
            href="/about"
            
            class="hx-text-sm contrast-more:hx-text-gray-700 contrast-more:dark:hx-text-gray-100 hx-relative -hx-ml-2 hx-hidden hx-whitespace-nowrap hx-p-2 md:hx-inline-block hx-text-gray-600 hover:hx-text-gray-800 dark:hx-text-gray-400 dark:hover:hx-text-gray-200"
          >
            <span class="hx-text-center">关于</span>
          </a><div class="search-wrapper hx-relative md:hx-w-64">
  <div class="hx-relative hx-flex hx-items-center hx-text-gray-900 contrast-more:hx-text-gray-800 dark:hx-text-gray-300 contrast-more:dark:hx-text-gray-300">
    <input
      placeholder="Search..."
      class="search-input hx-block hx-w-full hx-appearance-none hx-rounded-lg hx-px-3 hx-py-2 hx-transition-colors hx-text-base hx-leading-tight md:hx-text-sm hx-bg-black/[.05] dark:hx-bg-gray-50/10 focus:hx-bg-white dark:focus:hx-bg-dark placeholder:hx-text-gray-500 dark:placeholder:hx-text-gray-400 contrast-more:hx-border contrast-more:hx-border-current"
      type="search"
      value=""
      spellcheck="false"
    />
    <kbd
      class="hx-absolute hx-my-1.5 hx-select-none ltr:hx-right-1.5 rtl:hx-left-1.5 hx-h-5 hx-rounded hx-bg-white hx-px-1.5 hx-font-mono hx-text-[10px] hx-font-medium hx-text-gray-500 hx-border dark:hx-border-gray-100/20 dark:hx-bg-dark/50 contrast-more:hx-border-current contrast-more:hx-text-current contrast-more:dark:hx-border-current hx-items-center hx-gap-1 hx-transition-opacity hx-pointer-events-none hx-hidden sm:hx-flex"
    >
      CTRL K
    </kbd>
  </div>

  <div>
    <ul
      class="search-results hextra-scrollbar hx-hidden hx-border hx-border-gray-200 hx-bg-white hx-text-gray-100 dark:hx-border-neutral-800 dark:hx-bg-neutral-900 hx-absolute hx-top-full hx-z-20 hx-mt-2 hx-overflow-auto hx-overscroll-contain hx-rounded-xl hx-py-2.5 hx-shadow-xl hx-max-h-[min(calc(50vh-11rem-env(safe-area-inset-bottom)),400px)] md:hx-max-h-[min(calc(100vh-5rem-env(safe-area-inset-bottom)),400px)] hx-inset-x-0 ltr:md:hx-left-auto rtl:md:hx-right-auto contrast-more:hx-border contrast-more:hx-border-gray-900 contrast-more:dark:hx-border-gray-50 hx-w-screen hx-min-h-[100px] hx-max-w-[min(calc(100vw-2rem),calc(100%+20rem))]"
      style="transition: max-height 0.2s ease 0s;"
    ></ul>
  </div>
</div>
<a href="/cart" class="flex items-center">
      🛒 购物车
      <span class="cart-badge ml-1 text-sm bg-red-500 text-white rounded-full px-2 hidden"></span>
    </a>

    <button type="button" aria-label="Menu" class="hamburger-menu -hx-mr-2 hx-rounded hx-p-2 active:hx-bg-gray-400/20 md:hx-hidden"><svg height=24 fill="none" viewBox="0 0 24 24" stroke="currentColor"><g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8H20"></path></g><g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16H20"></path></g></svg></button>
  </nav>
</div>

<script>
  
  document.addEventListener('DOMContentLoaded', function() {
    const cartManager = {
      key: 'global_cart',
      getCart() {
        return JSON.parse(localStorage.getItem(this.key)) || []
      },
      updateBadge() {
        const total = this.getCart().reduce((sum, item) => sum + item.quantity, 0)
        document.querySelectorAll('.cart-badge').forEach(badge => {
          badge.textContent = total
          badge.classList.toggle('hidden', total === 0)
        })
      }
    }
    
    
    cartManager.updateBadge()
    
    
    window.addEventListener('storage', function(e) {
      if(e.key === cartManager.key) {
        cartManager.updateBadge()
      }
    })
  })
  </script>

<div id="loading" class="fixed inset-0 bg-white flex items-center justify-center z-50">
  <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-500"></div>
</div>


<div id="payment-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
  <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-lg p-8 w-11/12 max-w-md">
    <div class="flex justify-between items-center mb-6">
      <h3 class="text-xl font-bold">选择支付方式</h3>
      <button onclick="closePaymentModal()" class="text-gray-500 hover:text-gray-700">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
  
    
    <div id="countdown" class="text-center text-sm text-gray-600 mb-4">
      请在 <span id="countdown-time" class="text-red-500 font-bold animate-pulse">120</span> 秒内完成支付，超时将自动取消订单！
    </div>

    <div class="space-y-6">
      <div>
        <button 
          class="w-full p-4 border-2 border-gray-200 rounded-xl hover:border-red-500 hover:shadow-md transition-all active:scale-95"
          data-type="alipay"
          onclick="showQRCode('alipay')"
        >
          <img src="/images/alipay-logo.png" alt="支付宝" class="h-10 mx-auto">
        </button>
        <div id="alipay-qr" class="hidden mt-4">
          <img src="/images/alipay-qrcode.jpg" 
               class="w-48 mx-auto border rounded-lg p-2"
               onerror="this.src='/images/default-qrcode.png'">
          <p class="text-center mt-2 text-sm text-gray-600">支付宝扫一扫付款</p>
        </div>
      </div>

      <div>
        <button 
          class="w-full p-4 border-2 border-gray-200 rounded-xl hover:border-red-500 hover:shadow-md transition-all active:scale-95"
          data-type="wechat"
          onclick="showQRCode('wechat')"
        >
          <img src="/images/wechat-logo.png" alt="微信" class="h-10 mx-auto">
        </button>
        <div id="wechat-qr" class="hidden mt-4">
          <img src="/images/wechat-qrcode.jpg" 
               class="w-48 mx-auto border rounded-lg p-2"
               onerror="this.src='/images/default-qrcode.png'">
          <p class="text-center mt-2 text-sm text-gray-600">微信扫一扫付款</p>
        </div>
      </div>
    </div>

    <div class="mt-6 text-center text-sm text-gray-500">
      <p>支付完成后请联系客服</p>
      <p>提供支付截图和订单号</p>
    </div>
  </div>
</div>


<div class="container mx-auto px-4 py-8 max-w-4xl">
  <h1 class="text-3xl font-bold mb-8">订单确认</h1>

  
  <div class="bg-white p-6 rounded-lg shadow-md mb-8">
    <div class="flex justify-between items-start">
      <div class="space-y-2 flex-1">
        <h2 class="text-xl font-semibold">收货信息</h2>
        <div class="text-gray-700">
          <p><span class="font-medium">收件人：</span><span id="shipping-name" class="text-gray-900"></span></p>
          <p><span class="font-medium">联系电话：</span><span id="shipping-phone" class="text-gray-900"></span></p>
          <p><span class="font-medium">配送地址：</span><span id="shipping-address" class="text-gray-900"></span></p>
        </div>
      </div>
      <button 
        onclick="window.location.href='/cart'"
        class="text-red-500 hover:text-red-600 flex items-center"
      >
        <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
        </svg>
        修改
      </button>
    </div>

    
    <div class="mt-6 pt-6 border-t">
      <label class="flex items-center cursor-pointer">
        <input 
          type="checkbox" 
          id="need-invoice" 
          class="w-4 h-4 mr-2 rounded border-gray-300 text-red-600 focus:ring-red-500"
        >
        <span class="text-gray-700">需要开具电子发票</span>
      </label>
      <div id="invoice-fields" class="hidden mt-4 space-y-3 transition-all duration-300">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">发票抬头</label>
          <input 
            type="text" 
            id="invoice-title"
            required
            class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-red-500 focus:border-red-500"
            placeholder="请输入单位名称或个人姓名"
          >
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">纳税人识别号</label>
          <input 
            type="text" 
            id="invoice-tax-id"
            required
            class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-red-500 focus:border-red-500"
            placeholder="请输入18位税号（个人请填写身份证号码）"
          >
        </div>
      </div>
    </div>
  </div>

  
  <div class="bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-xl font-semibold mb-4">商品清单</h2>
  
    
    <div class="overflow-x-auto">
      <table class="w-full min-w-[600px] sm:min-w-0">
        
        <thead class="bg-gray-50">
          <tr>
            
            <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 whitespace-nowrap hidden sm:table-cell">商品图片</th>
            
            <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 whitespace-nowrap">商品信息</th>
            
            <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 whitespace-nowrap">单价</th>
            
            <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 whitespace-nowrap">数量</th>
            
            <th class="px-4 py-3 text-left text-sm font-medium text-gray-500 whitespace-nowrap">金额</th>
          </tr>
        </thead>
        <tbody id="items-container" class="divide-y divide-gray-200">
          
        </tbody>
      </table>
    </div>
  
    
    <div class="mt-6 pt-4 border-t space-y-4">
      <div class="flex justify-between">
        <span class="text-gray-600">商品总价：</span>
        <span id="subtotal" class="text-gray-900">¥0.00</span>
      </div>
      <div class="flex justify-between">
        <span class="text-gray-600">运费：</span>
        <span class="text-gray-900">¥0.00</span>
      </div>
      <div class="flex justify-between text-lg font-semibold">
        <span class="text-gray-900">应付总额：</span>
        <span class="text-red-500" id="total-amount">¥0.00</span>
      </div>
    </div>
  </div>

  
  <div class="mt-8 space-y-4 sticky bottom-0 bg-white py-4 backdrop-blur-md bg-opacity-95">
    <button 
      id="confirm-payment" 
      class="w-full bg-red-500 hover:bg-red-600 text-white py-4 rounded-lg text-lg font-medium transition-colors shadow-md"
    >
      立即支付（¥<span id="pay-amount">0.00</span>）
    </button>
    <div class="text-center text-sm text-gray-500">
      支付即表示您已同意
      <a href="/terms" class="text-red-500 hover:underline">《服务协议》</a>
      和
      <a href="/privacy" class="text-red-500 hover:underline">《隐私政策》</a>
    </div>
  </div>
</div>

<script>
  
  let paymentInProgress = false;
  let countdownInterval = null;
  const CART_KEY = 'global_cart';
  const CHECKOUT_KEY = 'checkoutData';
  const ORDER_SUCCESS_KEY = 'orderSuccessData';

  document.addEventListener('DOMContentLoaded', async () => {
    const loading = document.getElementById('loading');
    try {
      initInvoiceSection();
      const [checkoutData, cartData] = loadData();
      validateData(checkoutData, cartData);
      renderPage(checkoutData);
      bindEvents();
    } catch (error) {
      handleInitError(error);
    } finally {
      loading.style.display = 'none';
    }
  });

  function initInvoiceSection() {
    const invoiceCheckbox = document.getElementById('need-invoice');
    const invoiceFields = document.getElementById('invoice-fields');
  
    invoiceCheckbox.addEventListener('change', () => {
      const isChecked = invoiceCheckbox.checked;
      invoiceFields.classList.toggle('hidden', !isChecked);
    
      if (isChecked) {
        invoiceFields.querySelectorAll('input').forEach(input => {
          input.required = true;
        });
      } else {
        invoiceFields.querySelectorAll('input').forEach(input => {
          input.required = false;
          input.setCustomValidity('');
        });
      }
    });
  }

  function loadData() {
    const checkoutData = JSON.parse(localStorage.getItem(CHECKOUT_KEY));
    const cartData = JSON.parse(localStorage.getItem(CART_KEY)) || [];
  
    if (!checkoutData) throw new Error('订单数据不存在，请重新下单');
    return [checkoutData, cartData];
  }

  function validateData(checkoutData, cartData) {
    if (!checkoutData.cartItems?.length || !checkoutData.shippingInfo) {
      throw new Error('订单信息不完整');
    }
  
    const MAX_AGE = 30 * 60 * 1000;
    if (Date.now() - checkoutData.timestamp > MAX_AGE) {
      localStorage.removeItem(CHECKOUT_KEY);
      throw new Error('订单已过期，请重新下单');
    }
  
    const cartItemIds = new Set(cartData.map(item => item.uid));
    const missingItems = checkoutData.cartItems.filter(item => !cartItemIds.has(item.uid));
    if (missingItems.length > 0) throw new Error('购物车商品已变更，请重新确认订单');
  }

  function renderPage(data) {
    document.getElementById('shipping-name').textContent = data.shippingInfo.name;
    document.getElementById('shipping-phone').textContent = data.shippingInfo.phone;
    document.getElementById('shipping-address').textContent = data.shippingInfo.address;
  
    const container = document.getElementById('items-container');
    container.innerHTML = data.cartItems.map(item => `
      <tr class="hover:bg-gray-50 transition-colors">
        <td class="px-4 py-3 whitespace-nowrap hidden sm:table-cell">
          <img src="${escapeHTML(item.image)}" 
               class="w-16 h-16 object-cover rounded-md"
               onerror="this.src='/images/placeholder-product.jpg'">
        </td>
        <td class="px-4 py-3">
          <h3 class="font-medium">${escapeHTML(item.title)}</h3>
          ${item.spec ? `<p class="text-sm text-gray-500">规格：${escapeHTML(item.spec)}</p>` : ''}
        </td>
        <td class="px-4 py-3 text-gray-700 whitespace-nowrap">¥${item.price.toFixed(2)}</td>
        <td class="px-4 py-3 text-gray-700 whitespace-nowrap">${item.quantity}</td>
        <td class="px-4 py-3 text-red-500 font-medium whitespace-nowrap">¥${(item.price * item.quantity).toFixed(2)}</td>
      </tr>
    `).join('');
  
    const subtotal = data.cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    document.getElementById('subtotal').textContent = `¥${subtotal.toFixed(2)}`;
    document.getElementById('total-amount').textContent = `¥${subtotal.toFixed(2)}`;
    document.getElementById('pay-amount').textContent = subtotal.toFixed(2);
  }

  function bindEvents() {
    document.getElementById('confirm-payment').addEventListener('click', handlePayment);
    document.getElementById('payment-modal').addEventListener('click', e => {
      if (e.target === document.getElementById('payment-modal')) closePaymentModal();
    });
  }

  
  async function handlePayment() {
  if (paymentInProgress) return;
  paymentInProgress = true;

  try {
    const invoiceData = validateInvoice();
    console.log("发票信息校验通过:", invoiceData);

    saveOrderData(invoiceData); 
    console.log("订单数据保存成功:", localStorage.getItem(ORDER_SUCCESS_KEY));

    
    showPaymentModal();
    startCountdown();
  } catch (error) {
    console.error("支付失败:", error.message);
    alert(`支付失败: ${error.message}`);
  } finally {
    paymentInProgress = false;
  }
}

  
  function saveOrderData(invoiceData) {
  const checkoutData = JSON.parse(localStorage.getItem(CHECKOUT_KEY));
  console.log("CHECKOUT_KEY 数据:", checkoutData);
  
  if (!checkoutData) {
    throw new Error("订单数据丢失。请返回购物车重新下单！");
  }

  const orderNumber = `ORDER_${Date.now()}_${Math.floor(Math.random() * 9000) + 1000}`;
  const orderData = {
    orderNumber,
    items: checkoutData.cartItems,
    shippingInfo: checkoutData.shippingInfo,
    total: parseFloat(document.getElementById('total-amount').textContent.slice(1)),
    timestamp: new Date().toISOString(),
    invoice: invoiceData
  };

  console.log("生成的订单数据:", orderData);
  localStorage.setItem(ORDER_SUCCESS_KEY, JSON.stringify(orderData));
  console.log("订单数据已保存到 localStorage:", localStorage.getItem(ORDER_SUCCESS_KEY));
}

  
  function validateInvoice() {
  const needInvoice = document.getElementById('need-invoice').checked;
  if (!needInvoice) return null;

  const titleInput = document.getElementById('invoice-title');
  const taxIdInput = document.getElementById('invoice-tax-id');
  let isValid = true;

  
  titleInput.classList.remove('input-error');
  taxIdInput.classList.remove('input-error');

  const title = titleInput.value.trim();
  const taxId = taxIdInput.value.trim();

  if (!title) {
    titleInput.classList.add('input-error');
    isValid = false;
  }

  if (taxId && taxId.length !== 18) {
    taxIdInput.classList.add('input-error');
    isValid = false;
  }

  if (!isValid) {
    throw new Error('请填写完整的发票信息');
  }

  return { title, taxId };
}

  

  function startCountdown() {
  let seconds = 120;
  const countdownElement = document.getElementById('countdown-time');
  const modalCloseBtn = document.querySelector('#payment-modal button[onclick="closePaymentModal()"]');
  
  
  modalCloseBtn.disabled = false;
  
  countdownInterval = setInterval(() => {
    countdownElement.textContent = seconds--;
    
    
    if (seconds <= 10) {
      countdownElement.style.animation = 'pulse 0.8s infinite';
    }
    
    if (seconds < 0) {
  clearInterval(countdownInterval);
  
  
  localStorage.removeItem(CART_KEY);
  localStorage.removeItem(CHECKOUT_KEY);

  
  const orderData = localStorage.getItem(ORDER_SUCCESS_KEY);
  if (orderData) {
    console.log("订单数据存在，跳转到成功页面:", orderData);
    window.location.href = '/order-success/';
  } else {
    alert("订单创建失败，请联系客服");
    closePaymentModal();
  }
}
  }, 1000);
}

  function handleInitError(error) {
    console.error('初始化错误:', error);
    localStorage.removeItem(CHECKOUT_KEY);
    alert(error.message);
    window.location.href = '/cart';
  }

  function showPaymentModal() {
    const modal = document.getElementById('payment-modal');
    modal.classList.remove('hidden');
    document.body.classList.add('overflow-hidden');
  }
  

  function closePaymentModal() {
  if (seconds > 0) {
    const confirmClose = confirm('支付尚未完成，确定要取消支付吗？');
    if (!confirmClose) return;
  }
  
  clearInterval(countdownInterval);
  const modal = document.getElementById('payment-modal');
  modal.classList.add('hidden');
  document.body.classList.remove('overflow-hidden');
  document.querySelectorAll('[id$="-qr"]').forEach(el => el.classList.add('hidden'));
  
  
  document.getElementById('countdown-time').textContent = '120';
  document.getElementById('countdown-time').style.animation = '';
}

  function showQRCode(type) {
    document.querySelectorAll('[id$="-qr"]').forEach(el => el.classList.add('hidden'));
    document.getElementById(`${type}-qr`).classList.remove('hidden');
  }



  function escapeHTML(str) {
  const div = document.createElement('div');
  div.textContent = str;
  return div.innerHTML
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#39;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;');
}


function safeCurrency(amount) {
  return `¥${Number(amount).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}`;
}

</script>


      <footer class="bg-gray-100 pb-[env(safe-area-inset-bottom)] dark:bg-neutral-900 print:bg-transparent"><div class="max-w-screen-xl mx-auto pl-[max(env(safe-area-inset-left),1.5rem)] pr-[max(env(safe-area-inset-right),1.5rem)] text-gray-600 dark:text-gray-400">
<script src="https://cdn.staticfile.net/translate.js/3.12.0/translate.js"></script>
<script>
    translate.language.setLocal('chinese_simplified');
    translate.selectLanguageTag.languages = 'english,chinese_simplified,chinese_traditional,spanish,french,arabic,russian,portuguese,japanese,korean';
    translate.service.use('client.edge');
    translate.execute();
</script>   


</div><div class="container mx-auto px-4 pt-8">
    <div class="grid grid-cols-1 gap-8 md:grid-cols-4">
      
      <div>
        <h4 class="mb-4 text-lg font-semibold">关于我们</h4>
        <p class="space-y-2">变频器软启动柜厂家主营：高品质在线软启动器，旁路软起动器，在线软启动柜，矢量变频器，变频控制柜，高低压元器件及成套设备，服务全球客户。我们欢迎全球代理商、分销商、零售商以及其他合作伙伴加入我们，共同发展互利共赢的商业关系。</p>
      </div>

      
      <div>
        <h4 class="mb-4 text-lg font-semibold">快速链接</h4>
        <ul class="space-y-2">
          <li><a href="/products" class="transition duration-300 hover:text-blue-400">产品展示</a></li>
          <li><a href="/docs" class="transition duration-300 hover:text-blue-400">技术文档</a></li>
          <li><a href="/blog" class="transition duration-300 hover:text-blue-400">行业资讯</a></li>
          <li><a href="/inverter-selection-system" class="transition duration-300 hover:text-blue-400">变频器选型系统</a></li>
          <li><a href="/soft-starter-selection-system" class="transition duration-300 hover:text-blue-400">软启动选型系统</a></li>
        </ul>
      </div>

      
      <div>
        <h3 class="mb-4 text-lg font-semibold">联系我们</h3>
        <ul class="space-y-2">
          <li>地址: 山东省临沂市兰山区通达路与清河北路交汇东北角</li>
          <li>电话: &#43;86-150-6499-9739</li>
          <li>邮箱: sales@lyskjd.com</li>
          <li>工作时间:  9:00-18:00（周一至周六）</li>
        </ul>
      </div>

      
      <div>
        <h4 class="mb-4 text-lg font-semibold">关注我们</h4>
        
        <div class="flex items-center justify-center space-x-3">
          
          <div class="text-center">
            <img src="/images/qygzh.jpg" alt="公众号二维码" class="mx-auto h-24 w-24 rounded shadow-md">
            <p class="mt-1 text-sm text-gray-600">公众号</p>
          </div>
          
          <div class="text-center">
            <img src="/images/douyin.jpg" alt="抖音二维码" class="mx-auto h-24 w-24 rounded shadow-md">
            <p class="mt-1 text-sm text-gray-600">抖音</p>
          </div>
          
          <div class="text-center">
            <img src="/images/sk-wechat.jpg" alt="微信二维码" class="mx-auto h-24 w-24 rounded shadow-md">
            <p class="mt-1 text-sm text-gray-600">微信</p>
          </div>
        </div>
      </div>
    </div>

    
    <div class="mt-8 border-t border-gray-700 pt-4 text-center text-gray-400">
      <p>&copy; 2025 临沂森阔机电有限公司 All rights reserved.</p>
      <p class="text-sm"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener">鲁ICP备17034385-2</a></p>
    </div>
  </div>
</footer>
    
    <script defer src="/js/main.min.d0f0346255ba9418db8fcf7f9440ca4e532e06276d8df17497e19e1045ee360b.js" integrity="sha256-0PA0YlW6lBjbj89/lEDKTlMuBidtjfF0l&#43;GeEEXuNgs="></script>
<script defer src="/lib/flexsearch/flexsearch.bundle.min.0425860527cc9968f9f049421c7a56b39327d475e2e3a8f550416be3a9134327.js" integrity="sha256-BCWGBSfMmWj58ElCHHpWs5Mn1HXi46j1UEFr46kTQyc="></script>
    <script defer src="/en.search.min.0b444174a2d66936193755eccfb66af827ce3d9e3aa2223167ea9490ce97ace4.js" integrity="sha256-C0RBdKLWaTYZN1Xsz7Zq&#43;CfOPZ46oiIxZ&#43;qUkM6XrOQ="></script>

  </body>
</html>
